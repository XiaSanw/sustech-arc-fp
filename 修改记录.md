# ä¿®æ”¹è®°å½•

## 2026-01-07 - å¥–åŠ±æƒé‡ä¼˜åŒ–ï¼ˆè§£å†³è®­ç»ƒ2200+è¿­ä»£å´©æºƒé—®é¢˜ï¼‰

### é—®é¢˜æè¿°
- è®­ç»ƒåˆ°2200+è¿­ä»£æ—¶å‡ºç°å·¨å¤§çš„loss
- æ€€ç–‘æ˜¯å¥–åŠ±æƒé‡è®¾ç½®ä¸åˆç†å¯¼è‡´

### æ ¹æœ¬åŸå› åˆ†æ
1. **æƒ©ç½šæƒé‡è¿‡å¤§**ï¼š`pen_feet_distance = -100` å¤ªå¤§ï¼Œå•ä¸ªæƒ©ç½šé¡¹è¶…è¿‡æ‰€æœ‰æ­£å¥–åŠ±ä¹‹å’Œ
2. **å¥–åŠ±å°ºåº¦å¤±è¡¡**ï¼šæ­£å¥–åŠ±æ€»å’Œçº¦14ï¼Œä½†å•ä¸ªæƒ©ç½šå¯è¾¾-100
3. **è®­ç»ƒè¿‡ç¨‹**ï¼š
   - å‰æœŸï¼ˆ0-2000è¿­ä»£ï¼‰ï¼šåŠ¨ä½œå¹…åº¦å°ï¼Œä¸è§¦å‘å¤§æƒ©ç½š
   - 2000+è¿­ä»£ï¼šç­–ç•¥æ¢ç´¢æ›´å¤§åŠ¨ä½œç©ºé—´
   - è§¦å‘å¤§æƒ©ç½š â†’ æ€»å¥–åŠ±å˜æˆ-100~-200 â†’ ä»·å€¼å‡½æ•°ä¼°è®¡è¯¯å·® â†’ lossæš´å¢

---

### ä¿®æ”¹æ–¹æ¡ˆï¼šä¿å®ˆé…ç½®ï¼ˆæ¨èï¼‰

#### æ–‡ä»¶ä½ç½®
`exts/bipedal_locomotion/bipedal_locomotion/tasks/locomotion/cfg/PF/limx_base_env_cfg.py`

#### å…·ä½“ä¿®æ”¹ï¼ˆRewardsCfgç±»ï¼Œç¬¬403-500è¡Œï¼‰

##### 1. æ­£å¥–åŠ±ï¼ˆé™ä½æƒé‡ï¼Œå¹³è¡¡æ•´ä½“ï¼‰

```python
# åŸé…ç½® â†’ æ–°é…ç½®
rew_lin_vel_xy = RewTerm(
    func=mdp.track_lin_vel_xy_exp,
    weight=5.0,  # ä» 8.0 â†’ 5.0
    params={"command_name": "base_velocity", "std": math.sqrt(0.2)}
)

rew_ang_vel_z = RewTerm(
    func=mdp.track_ang_vel_z_exp,
    weight=2.5,  # ä» 4.0 â†’ 2.5
    params={"command_name": "base_velocity", "std": math.sqrt(0.2)}
)
```

##### 2. å…³é”®æƒ©ç½šé¡¹ï¼ˆå¤§å¹…é™ä½ï¼‰

```python
# â­â­â­ æœ€å…³é”®çš„ä¿®æ”¹ï¼
pen_feet_distance = RewTerm(
    func=mdp.feet_distance,
    weight=-5.0,  # ä» -100 â†’ -5.0ï¼ˆé™ä½20å€ï¼ï¼‰
    params={
        "min_feet_distance": 0.115,
        "feet_links_name": ["foot_[RL]_Link"]
    }
)

pen_base_height = RewTerm(
    func=mdp.base_com_height,
    params={"target_height": 0.78},
    weight=-5.0,  # ä» -20.0 â†’ -5.0
)

pen_flat_orientation = RewTerm(
    func=mdp.flat_orientation_l2,
    weight=-2.0  # ä» -10.0 â†’ -2.0
)
```

##### 3. å…¶ä»–å°æƒ©ç½šï¼ˆç•¥å¾®é™ä½ï¼‰

```python
pen_feet_regulation = RewTerm(
    func=mdp.feet_regulation,
    weight=-0.05,  # ä» -0.1 â†’ -0.05
    params={
        "asset_cfg": SceneEntityCfg("robot", body_names=["foot_[RL]_Link"]),
        "base_height_target": 0.65,
        "foot_radius": 0.03
    },
)

pen_joint_torque = RewTerm(
    func=mdp.joint_torques_l2,
    weight=-0.00005  # ä» -0.00008 â†’ -0.00005
)

pen_joint_accel = RewTerm(
    func=mdp.joint_acc_l2,
    weight=-1e-07  # ä» -2.5e-07 â†’ -1e-07
)

pen_action_rate = RewTerm(
    func=mdp.action_rate_l2,
    weight=-0.003  # ä» -0.005 â†’ -0.003
)

pen_action_smoothness = RewTerm(
    func=mdp.ActionSmoothnessPenalty,
    weight=-0.003  # ä» -0.005 â†’ -0.003
)

pen_joint_pos_limits = RewTerm(
    func=mdp.joint_pos_limits,
    weight=-1.0  # ä» -2.0 â†’ -1.0
)

pen_joint_vel_l2 = RewTerm(
    func=mdp.joint_vel_l2,
    weight=-5e-04  # ä» -1e-03 â†’ -5e-04
)

pen_joint_powers = RewTerm(
    func=mdp.joint_powers_l1,
    weight=-2e-04  # ä» -5e-04 â†’ -2e-04
)

pen_undesired_contacts = RewTerm(
    func=mdp.undesired_contacts,
    weight=-0.3,  # ä» -0.5 â†’ -0.3
    params={
        "sensor_cfg": SceneEntityCfg("contact_forces", body_names=["abad_.*", "hip_.*", "knee_.*", "base_Link"]),
        "threshold": 10.0,
    },
)

foot_landing_vel = RewTerm(
    func=mdp.foot_landing_vel,
    weight=-0.3,  # ä» -0.5 â†’ -0.3
    params={
        "asset_cfg": SceneEntityCfg("robot", body_names=["foot_[RL]_Link"]),
        "sensor_cfg": SceneEntityCfg("contact_forces", body_names=["foot_[RL]_Link"]),
        "foot_radius": 0.03,
        "about_landing_threshold": 0.08
    },
)
```

##### 4. ä¿æŒä¸å˜çš„é¡¹

```python
keep_balance = RewTerm(func=mdp.stay_alive, weight=1.0)
pen_lin_vel_z = RewTerm(func=mdp.lin_vel_z_l2, weight=-0.5)
pen_ang_vel_xy = RewTerm(func=mdp.ang_vel_xy_l2, weight=-0.05)
test_gait_reward = RewTerm(func=mdp.GaitReward, weight=1.0, params={...})
```

---

### ä¿®æ”¹æ€»ç»“è¡¨

| å¥–åŠ±é¡¹ | åŸæƒé‡ | æ–°æƒé‡ | å˜åŒ– |
|--------|--------|--------|------|
| `rew_lin_vel_xy` | 8.0 | 5.0 | â†“ 37.5% |
| `rew_ang_vel_z` | 4.0 | 2.5 | â†“ 37.5% |
| **`pen_feet_distance`** | **-100** | **-5.0** | **â†“ 95%** ğŸ”¥ |
| `pen_base_height` | -20.0 | -5.0 | â†“ 75% |
| `pen_flat_orientation` | -10.0 | -2.0 | â†“ 80% |
| `pen_feet_regulation` | -0.1 | -0.05 | â†“ 50% |
| `pen_action_rate` | -0.005 | -0.003 | â†“ 40% |
| `pen_action_smoothness` | -0.005 | -0.003 | â†“ 40% |
| `pen_undesired_contacts` | -0.5 | -0.3 | â†“ 40% |
| `foot_landing_vel` | -0.5 | -0.3 | â†“ 40% |
| å…¶ä»–å°æƒ©ç½š | è§ä¸Š | è§ä¸Š | â†“ 20-60% |

---

### å¯é€‰ï¼šå¦‚æœè¿˜ä¸ç¨³å®š

#### é™ä½å­¦ä¹ ç‡
æ–‡ä»¶ï¼š`exts/bipedal_locomotion/bipedal_locomotion/tasks/locomotion/agents/limx_rsl_rl_ppo_cfg.py`

```python
# ç¬¬32è¡Œæˆ–å¯¹åº”é…ç½®ç±»
algorithm = RslRlPpoAlgorithmCfg(
    learning_rate=5.0e-4,  # ä» 1e-3 â†’ 5e-4
    # æˆ–æ›´ä¿å®ˆï¼šlearning_rate=3.0e-4
)
```

#### é™ä½å¤–åŠ›å¹²æ‰°ï¼ˆè®­ç»ƒåˆæœŸï¼‰
æ–‡ä»¶ï¼š`limx_base_env_cfg.py` ç¬¬377-399è¡Œ

```python
push_robot = EventTerm(
    func=mdp.apply_external_force_torque_stochastic,
    mode="interval",
    interval_range_s=(5.0, 10.0),
    params={
        "force_range": {
            "x": (-400.0, 400.0),  # ä» -600 â†’ -400
            "y": (-400.0, 400.0),
        },
        "probability": 0.2,  # ä» 0.3 â†’ 0.2
    }
)
```

---

### è®­ç»ƒå»ºè®®

1. **åˆ é™¤æ—§æ—¥å¿—**é¿å…æ··æ·†
2. **é‡æ–°è®­ç»ƒ**ï¼Œç›‘æ§åˆ°3000+è¿­ä»£
3. **å…³æ³¨æŒ‡æ ‡**ï¼š
   - `Episode/mean_reward` åº”å¹³ç¨³ä¸Šå‡
   - `Loss/policy_loss` åº”åœ¨ 0.01-0.1 èŒƒå›´
   - `Loss/value_loss` åº”é€æ¸ä¸‹é™
4. **å¦‚æœç¨³å®š**ï¼Œå¯é€æ­¥å¢åŠ æŸäº›æƒ©ç½šæƒé‡
5. **å¦‚æœä»ä¸ç¨³å®š**ï¼Œé™ä½å­¦ä¹ ç‡

---

### é¢„æœŸæ•ˆæœ

- è®­ç»ƒæ›²çº¿æ›´å¹³ç¨³ï¼Œä¸ä¼šåœ¨2200+è¿­ä»£å´©æºƒ
- å¥–åŠ±å€¼åœ¨åˆç†èŒƒå›´å†…ï¼ˆ-10 åˆ° +20ï¼‰
- å…è®¸ç­–ç•¥æ›´å……åˆ†åœ°æ¢ç´¢ï¼Œè€Œä¸è¢«è¿‡å¤§çš„æƒ©ç½šé™åˆ¶

